<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>js新手地下城第三關-計算機</title>
    <link rel="stylesheet" href="../reset.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="calculator">
        <div class="screen">
            <div class="formula">
            </div>
            <div class="result">
                0
            </div>
        </div>
        <ul class="keyboard">
            <li id="7">7</li>
            <li id="8">8</li>
            <li id="9">9</li>
            <li id="/">÷</li>
            <li id="4">4</li>
            <li id="5">5</li>
            <li id="6">6</li>
            <li id="*">×</li>
            <li id="1">1</li>
            <li id="2">2</li>
            <li id="3">3</li>
            <li id="+">+</li>
            <li id="0">0</li>
            <li id="00">00</li>
            <li id=".">.</li>
            <li id="-">-</li>
            <li id="empty">AC</li>
            <li id="delete">⌫</li>
            <li id="equal">=</li>
        </ul>
    </div>
    <script>
        var keyboard = document.querySelector('.keyboard');
        var specialArr=["empty","delete","equal"];
        var operatorsArr=["+","-","*","/","."];
        var formula = document.querySelector('.formula');
        var idformula="";
        var result = document.querySelector('.result');

        keyboard.addEventListener('click',function(e){
            let clicked =e.target.id;
            if(e.target.nodeName=="UL")return false;
            else  if(specialArr.indexOf(clicked)!=-1){
                let last=idformula.length;
                switch(clicked){
                    case "empty":
                    formula.innerHTML='<span style="visibility: hidden;">0</span>';
                    idformula="";
                    result.innerText ="0";
                    break;
                    case "delete":
                    formula.innerText=formula.innerText.slice(0,last-1);
                    idformula=idformula.slice(0,last-1);
                    break;
                    case "equal":
                    try{
                        if(operatorsArr.indexOf(idformula.charAt(last-1))!=-1)idformula += "0";
                        result.innerText=eval(idformula);
                    }
                    catch(e){
                        alert(e);
                    }
                    formula.innerHTML="";
                    idformula="";
                    break;
                }
            }
            else if(operatorsArr.indexOf(clicked)!=-1){
                //運算符號
                if(formula.innerText.length>=39)alert('超過可輸入字元');
                else{
                    idformula+=clicked;
                    formula.innerText+= e.target.innerText;
                }
            }
            else{
                //數字                    
                if(formula.innerText.length>=39)alert('超過可輸入字元');
                else{
                    idformula+=clicked;
                    formula.innerText+=e.target.innerText;
                    try{
                        if(idformula.length>1 &&idformula.charAt(0)==="0")idformula = idformula.slice(1,idformula.length);
                        result.innerText=eval(idformula);
                    }
                    catch{
                        return false;
                    }
                }
            }
        });



    </script>
    
</body>
</html>